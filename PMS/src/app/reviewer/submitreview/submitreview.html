<div class="submit-review-container">
  <!-- Header Section -->
  <div class="review-header">
    <button class="btn-back" (click)="goBack()">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path d="M19 12H5M12 19l-7-7 7-7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      Back to Reviews
    </button>
    <div class="header-content">
      <h1 class="page-title">Submit Review</h1>
      <p class="page-subtitle">Provide comprehensive feedback for the research paper</p>
    </div>
  </div>

  <!-- Paper Information Card -->
  <div class="paper-info-card">
    <div class="info-header">
      <div class="paper-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M9 12h6M9 16h6M9 8h6M5 5h14a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2z" stroke-width="2"/>
        </svg>
      </div>
      <div class="paper-details">
        <h2>{{paperTitle}}</h2>
        <p class="authors">{{paperAuthors}}</p>
      </div>
      <button class="btn-download" (click)="downloadPaper()">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3" stroke-width="2" stroke-linecap="round"/>
        </svg>
        Download Paper
      </button>
    </div>
    <div class="info-meta">
      <div class="meta-item">
        <span class="meta-label">Category:</span>
        <span class="meta-value">{{paperCategory}}</span>
      </div>
      <div class="meta-item">
        <span class="meta-label">Submitted:</span>
        <span class="meta-value">{{submissionDate}}</span>
      </div>
      <div class="meta-item">
        <span class="meta-label">Due Date:</span>
        <span class="meta-value" [class.overdue]="isDueDateNear">{{dueDate}}</span>
      </div>
      <div class="meta-item">
        <span class="meta-label">Priority:</span>
        <span class="badge priority" [class]="priority">{{priority}}</span>
      </div>
    </div>
  </div>

  <!-- Review Form -->
  <form class="review-form" (ngSubmit)="submitReview()">
    <!-- Overall Rating Section -->
    <div class="form-section">
      <div class="section-header">
        <h3>Overall Recommendation</h3>
        <span class="required">*</span>
      </div>
      <div class="rating-options">
        <label class="rating-card" *ngFor="let option of recommendationOptions" 
               [class.selected]="recommendation === option.value">
          <input type="radio" 
                 name="recommendation" 
                 [value]="option.value" 
                 [(ngModel)]="recommendation"
                 required>
          <div class="rating-icon" [style.color]="option.color">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path [attr.d]="option.icon" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </div>
          <span class="rating-label">{{option.label}}</span>
          <span class="rating-description">{{option.description}}</span>
        </label>
      </div>
    </div>

    <!-- Quality Assessment -->
    <div class="form-section">
      <div class="section-header">
        <h3>Quality Assessment</h3>
        <span class="required">*</span>
      </div>
      <div class="assessment-grid">
        <div class="assessment-item" *ngFor="let criterion of qualityCriteria">
          <label class="criterion-label">
            {{criterion.name}}
            <span class="info-tooltip" [title]="criterion.description">ℹ️</span>
          </label>
          <div class="star-rating">
            <button type="button" 
                    class="star" 
                    *ngFor="let star of [1,2,3,4,5]"
                    [class.active]="criterion.rating >= star"
                    (click)="setRating(criterion, star)">
              ★
            </button>
          </div>
          <span class="rating-text">{{criterion.rating}}/5</span>
        </div>
      </div>
    </div>

    <!-- Detailed Review Sections -->
    <div class="form-section">
      <div class="section-header">
        <h3>Summary</h3>
        <span class="required">*</span>
      </div>
      <textarea class="form-textarea"
                [(ngModel)]="summary"
                name="summary"
                rows="4"
                placeholder="Provide a brief summary of the paper and your overall assessment..."
                required
                [maxlength]="1000"></textarea>
      <div class="char-count">{{summary.length}}/1000</div>
    </div>

    <div class="form-section">
      <div class="section-header">
        <h3>Strengths</h3>
        <span class="required">*</span>
      </div>
      <textarea class="form-textarea"
                [(ngModel)]="strengths"
                name="strengths"
                rows="5"
                placeholder="List the major strengths of this paper..."
                required
                [maxlength]="2000"></textarea>
      <div class="char-count">{{strengths.length}}/2000</div>
    </div>

    <div class="form-section">
      <div class="section-header">
        <h3>Weaknesses</h3>
        <span class="required">*</span>
      </div>
      <textarea class="form-textarea"
                [(ngModel)]="weaknesses"
                name="weaknesses"
                rows="5"
                placeholder="Describe the main weaknesses or areas for improvement..."
                required
                [maxlength]="2000"></textarea>
      <div class="char-count">{{weaknesses.length}}/2000</div>
    </div>

    <div class="form-section">
      <div class="section-header">
        <h3>Detailed Comments</h3>
        <span class="required">*</span>
      </div>
      <textarea class="form-textarea"
                [(ngModel)]="detailedComments"
                name="detailedComments"
                rows="8"
                placeholder="Provide detailed feedback on methodology, results, writing quality, and any other relevant aspects..."
                required
                [maxlength]="5000"></textarea>
      <div class="char-count">{{detailedComments.length}}/5000</div>
    </div>

    <div class="form-section">
      <div class="section-header">
        <h3>Questions for Authors</h3>
      </div>
      <textarea class="form-textarea"
                [(ngModel)]="questionsForAuthors"
                name="questionsForAuthors"
                rows="4"
                placeholder="List any questions you have for the authors (optional)..."
                [maxlength]="1500"></textarea>
      <div class="char-count">{{questionsForAuthors.length}}/1500</div>
    </div>

    <div class="form-section">
      <div class="section-header">
        <h3>Confidential Comments to Editor</h3>
      </div>
      <textarea class="form-textarea"
                [(ngModel)]="confidentialComments"
                name="confidentialComments"
                rows="4"
                placeholder="Private comments for the editor only (optional)..."
                [maxlength]="1500"></textarea>
      <div class="char-count">{{confidentialComments.length}}/1500</div>
    </div>

    <!-- File Upload Section -->
    <div class="form-section">
      <div class="section-header">
        <h3>Attach Review Document</h3>
      </div>
      <div class="file-upload-area" 
           [class.dragging]="isDragging"
           (dragover)="onDragOver($event)"
           (dragleave)="onDragLeave($event)"
           (drop)="onDrop($event)">
        <input type="file" 
               #fileInput 
               (change)="onFileSelected($event)" 
               accept=".pdf,.doc,.docx"
               hidden>
        <div class="upload-content" *ngIf="!uploadedFile">
          <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <p>Drag and drop your file here or</p>
          <button type="button" class="btn-upload" (click)="fileInput.click()">
            Browse Files
          </button>
          <p class="file-hint">PDF, DOC, DOCX up to 10MB</p>
        </div>
        <div class="uploaded-file" *ngIf="uploadedFile">
          <svg class="file-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M13 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V9z" stroke-width="2"/>
            <polyline points="13 2 13 9 20 9" stroke-width="2"/>
          </svg>
          <div class="file-info">
            <span class="file-name">{{uploadedFile.name}}</span>
            <span class="file-size">{{formatFileSize(uploadedFile.size)}}</span>
          </div>
          <button type="button" class="btn-remove" (click)="removeFile()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path d="M18 6L6 18M6 6l12 12" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="form-actions">
      <button type="button" class="btn-secondary" (click)="saveDraft()">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z" stroke-width="2"/>
          <polyline points="17 21 17 13 7 13 7 21" stroke-width="2"/>
          <polyline points="7 3 7 8 15 8" stroke-width="2"/>
        </svg>
        Save as Draft
      </button>
      <button type="button" class="btn-secondary" (click)="previewReview()">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke-width="2"/>
          <circle cx="12" cy="12" r="3" stroke-width="2"/>
        </svg>
        Preview
      </button>
      <button type="submit" class="btn-primary" [disabled]="!isFormValid()">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" stroke-width="2" stroke-linecap="round"/>
        </svg>
        Submit Review
      </button>
    </div>
  </form>
</div>

<!-- Confirmation Modal -->
<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{modalTitle}}</h2>
      <button class="btn-close" (click)="closeModal()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M18 6L6 18M6 6l12 12" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
    <div class="modal-body">
      <p style="white-space: pre-line;">{{modalContent}}</p>
    </div>
    <div class="modal-actions" *ngIf="showModalActions">
      <button class="btn-secondary" (click)="closeModal()">Cancel</button>
      <button class="btn-primary" (click)="confirmSubmit()">Confirm Submit</button>
    </div>
  </div>
</div>