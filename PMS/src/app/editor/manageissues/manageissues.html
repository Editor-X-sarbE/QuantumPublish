<div class="manage-issues-container">
  <div class="page-header">
    <div class="header-content">
      <h1>Manage Issues</h1>
      <p class="subtitle">Create, organize, and publish journal issues</p>
    </div>
    <button class="btn btn-create" (click)="openCreateIssueModal()">
      <span class="icon">+</span>
      Create New Issue
    </button>
  </div>

  <div class="filters-section">
    <div class="search-filter">
      <input 
        type="text" 
        placeholder="Search issues by title, volume, or year..." 
        [(ngModel)]="searchTerm"
        (input)="applyFilters()"
        class="search-input"
      >
      <span class="search-icon">ğŸ”</span>
    </div>

    <div class="filter-row">
      <select [(ngModel)]="filterStatus" (change)="applyFilters()" class="filter-select">
        <option value="">All Statuses</option>
        <option value="draft">Draft</option>
        <option value="inProgress">In Progress</option>
        <option value="published">Published</option>
        <option value="archived">Archived</option>
      </select>

      <select [(ngModel)]="filterYear" (change)="applyFilters()" class="filter-select">
        <option value="">All Years</option>
        <option value="2025">2025</option>
        <option value="2024">2024</option>
        <option value="2023">2023</option>
        <option value="2022">2022</option>
      </select>

      <button class="btn btn-filter-reset" (click)="resetFilters()" *ngIf="hasActiveFilters()">
        Clear Filters
      </button>
    </div>
  </div>

  <div class="stats-overview">
    <div class="stat-card">
      <div class="stat-icon">ğŸ“</div>
      <div class="stat-info">
        <div class="stat-value">{{ statistics.draft }}</div>
        <div class="stat-label">Draft Issues</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">âš™ï¸</div>
      <div class="stat-info">
        <div class="stat-value">{{ statistics.inProgress }}</div>
        <div class="stat-label">In Progress</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">âœ…</div>
      <div class="stat-info">
        <div class="stat-value">{{ statistics.published }}</div>
        <div class="stat-label">Published</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">ğŸ“š</div>
      <div class="stat-info">
        <div class="stat-value">{{ statistics.totalArticles }}</div>
        <div class="stat-label">Total Articles</div>
      </div>
    </div>
  </div>

  <div class="issues-grid">
    <div class="issue-card" *ngFor="let issue of filteredIssues" [attr.data-status]="issue.status">
      <div class="issue-header">
        <div class="issue-badge" [attr.data-status]="issue.status">
          {{ getStatusLabel(issue.status) }}
        </div>
        <div class="issue-menu">
          <button class="menu-btn" (click)="toggleMenu(issue.id)">â‹®</button>
          <div class="dropdown-menu" *ngIf="activeMenuId === issue.id">
            <button (click)="editIssue(issue)">Edit</button>
            <button (click)="duplicateIssue(issue)">Duplicate</button>
            <button (click)="archiveIssue(issue)">Archive</button>
            <button (click)="deleteIssue(issue)" class="delete-option">Delete</button>
          </div>
        </div>
      </div>

      <div class="issue-cover" [style.background-image]="'url(' + issue.coverImage + ')'">
        <div class="issue-overlay">
          <div class="volume-info">Volume {{ issue.volume }}, Issue {{ issue.issueNumber }}</div>
        </div>
      </div>

      <div class="issue-body">
        <h3 class="issue-title">{{ issue.title }}</h3>
        <div class="issue-meta">
          <span class="meta-item">
            <span class="meta-icon">ğŸ“…</span>
            {{ issue.publicationDate | date: 'MMM yyyy' }}
          </span>
          <span class="meta-item">
            <span class="meta-icon">ğŸ“„</span>
            {{ issue.articleCount }} articles
          </span>
        </div>
        <p class="issue-description">{{ issue.description }}</p>
      </div>

      <div class="issue-footer">
        <div class="progress-section" *ngIf="issue.status !== 'published'">
          <div class="progress-label">Completion: {{ issue.completionPercentage }}%</div>
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="issue.completionPercentage"></div>
          </div>
        </div>

        <div class="issue-actions">
          <button class="btn btn-secondary" (click)="manageArticles(issue)">
            Manage Articles
          </button>
          <button 
            class="btn btn-primary" 
            (click)="publishIssue(issue)"
            *ngIf="issue.status !== 'published'"
          >
            Publish
          </button>
          <button 
            class="btn btn-view" 
            (click)="viewIssue(issue)"
            *ngIf="issue.status === 'published'"
          >
            View Issue
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="empty-state" *ngIf="filteredIssues.length === 0">
    <div class="empty-icon">ğŸ“š</div>
    <h3>No Issues Found</h3>
    <p>{{ hasActiveFilters() ? 'Try adjusting your filters' : 'Create your first issue to get started' }}</p>
    <button class="btn btn-create" (click)="openCreateIssueModal()" *ngIf="!hasActiveFilters()">
      Create New Issue
    </button>
  </div>

  <div class="pagination" *ngIf="filteredIssues.length > 0 && totalPages > 1">
    <button class="pagination-btn" [disabled]="currentPage === 1" (click)="previousPage()">
      â† Previous
    </button>
    <span class="page-info">Page {{ currentPage }} of {{ totalPages }}</span>
    <button class="pagination-btn" [disabled]="currentPage === totalPages" (click)="nextPage()">
      Next â†’
    </button>
  </div>
</div>

<!-- Create/Edit Issue Modal -->
<div class="modal-overlay" *ngIf="showIssueModal" (click)="closeIssueModal()">
  <div class="modal-dialog" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ isEditMode ? 'Edit Issue' : 'Create New Issue' }}</h2>
      <button class="close-btn" (click)="closeIssueModal()">Ã—</button>
    </div>

    <div class="modal-body">
      <form class="issue-form">
        <div class="form-row">
          <div class="form-group">
            <label>Volume Number *</label>
            <input 
              type="number" 
              [(ngModel)]="issueForm.volume" 
              name="volume"
              placeholder="e.g., 5"
              required
            >
          </div>
          <div class="form-group">
            <label>Issue Number *</label>
            <input 
              type="number" 
              [(ngModel)]="issueForm.issueNumber" 
              name="issueNumber"
              placeholder="e.g., 3"
              required
            >
          </div>
        </div>

        <div class="form-group">
          <label>Issue Title *</label>
          <input 
            type="text" 
            [(ngModel)]="issueForm.title" 
            name="title"
            placeholder="e.g., Special Edition on Quantum Computing"
            required
          >
        </div>

        <div class="form-group">
          <label>Description</label>
          <textarea 
            [(ngModel)]="issueForm.description" 
            name="description"
            placeholder="Brief description of this issue..."
            rows="4"
          ></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Publication Date *</label>
            <input 
              type="date" 
              [(ngModel)]="issueForm.publicationDate" 
              name="publicationDate"
              required
            >
          </div>
          <div class="form-group">
            <label>Status</label>
            <select [(ngModel)]="issueForm.status" name="status">
              <option value="draft">Draft</option>
              <option value="inProgress">In Progress</option>
              <option value="published">Published</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label>Cover Image URL</label>
          <input 
            type="text" 
            [(ngModel)]="issueForm.coverImage" 
            name="coverImage"
            placeholder="https://example.com/cover.jpg"
          >
        </div>
      </form>
    </div>

    <div class="modal-footer">
      <button class="btn btn-cancel" (click)="closeIssueModal()">Cancel</button>
      <button class="btn btn-primary" (click)="saveIssue()">
        {{ isEditMode ? 'Update Issue' : 'Create Issue' }}
      </button>
    </div>
  </div>
</div>

<!-- Confirmation Modal -->
<div class="modal-overlay" *ngIf="showConfirmModal" (click)="closeConfirmModal()">
  <div class="modal-dialog modal-confirm" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ confirmTitle }}</h2>
      <button class="close-btn" (click)="closeConfirmModal()">Ã—</button>
    </div>
    <div class="modal-body">
      <p>{{ confirmMessage }}</p>
    </div>
    <div class="modal-footer">
      <button class="btn btn-cancel" (click)="closeConfirmModal()">Cancel</button>
      <button class="btn btn-danger" (click)="confirmAction()">Confirm</button>
    </div>
  </div>
</div>